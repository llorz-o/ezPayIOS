{"version":3,"file":"js/6481.fcd99e22.js","mappings":"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","sources":["webpack://ez_pay/./src/views/messages/index.vue?0de5","webpack://ez_pay/src/views/messages/index.vue","webpack://ez_pay/./src/views/messages/index.vue?3812","webpack://ez_pay/./src/views/messages/index.vue"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page page-messages\"},[_c('van-list',{attrs:{\"error-text\":_vm.errorText,\"error\":_vm.error,\"finished\":_vm.finished,\"finished-text\":\"暂无更多消息\"},on:{\"update:error\":function($event){_vm.error=$event},\"load\":_vm.loadList},model:{value:(_vm.loading),callback:function ($$v) {_vm.loading=$$v},expression:\"loading\"}},[_c('van-checkbox-group',{on:{\"change\":_vm.onCheckboxGroupChange},model:{value:(_vm.deleteList),callback:function ($$v) {_vm.deleteList=$$v},expression:\"deleteList\"}},_vm._l((_vm.list),function(item,index){return _c('van-cell',{key:index,class:{ disabled: item.status === 'Read' },attrs:{\"label\":_vm._f(\"dateFormat\")(item.createTime,'Y-M-D'),\"title\":item.title,\"clickable\":\"\",\"is-link\":\"\"},on:{\"click\":function () { return _vm.handlerClickMsg(item); }}},[_c('template',{slot:\"icon\"},[_c('van-checkbox',{attrs:{\"name\":item.contentId},nativeOn:{\"click\":function($event){$event.stopPropagation();return (function (e) {}).apply(null, arguments)}}})],1)],2)}),1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"page page-messages\">\n    <van-list v-model=\"loading\" :error-text=\"errorText\" :error.sync=\"error\" :finished=\"finished\"\n              finished-text=\"暂无更多消息\"\n              @load=\"loadList\">\n      <van-checkbox-group v-model=\"deleteList\" @change=\"onCheckboxGroupChange\">\n        <van-cell v-for=\"(item, index) in list\" :key=\"index\" :class=\"{ disabled: item.status === 'Read' }\"\n                  :label=\"item.createTime | dateFormat('Y-M-D')\"\n                  :title=\"item.title\" clickable is-link\n                  @click=\"() => handlerClickMsg(item)\">\n          <template slot=\"icon\">\n            <van-checkbox :name=\"item.contentId\" @click.stop.native=\"e => {}\">\n            </van-checkbox>\n          </template>\n        </van-cell>\n      </van-checkbox-group>\n    </van-list>\n  </div>\n</template>\n\n<script>\nimport {deleteMessages, getMessages, oneClickRead, setRead} from \"@/apis/user\";\n\nexport default {\n  data() {\n    return {\n      loading: false,\n      error: false,\n      finished: false,\n      errorText: \"加载失败，点击重试\",\n      list: [],\n      page: 1,\n      pageSize: 20,\n      deleteList: [],\n    };\n  },\n  created() {\n    this.setTopBar()\n  },\n  methods: {\n    setTopBar(deleteMode) {\n      if (deleteMode) {\n        this.$root.$emit(\"root:set-topbar\", [\"left-back\", \"custom-btn\"], {\n          label: \"一键删除\",\n          onClick: () => {\n            deleteMessages({contentId: this.deleteList.join(',')}).then(({ok, msg}) => {\n              if (ok) {\n                const map = this.deleteList.reduce((previous, current) => ({\n                  ...previous,\n                  [current]: 1\n                }), {})\n                this.list = this.list.filter((item) => !map[item.contentId]);\n                this.deleteList = []\n              } else {\n                this.$toast.fail(msg);\n              }\n            });\n          },\n        });\n      } else {\n        this.$root.$emit(\"root:set-topbar\", [\"left-back\", \"custom-btn\"], {\n          label: \"一键已读\",\n          onClick: () => {\n            oneClickRead().then(({ok, msg}) => {\n              if (ok) {\n                this.list.map((item) => {\n                  item.status = \"Read\";\n                  return item;\n                });\n              } else {\n                this.$toast.fail(msg);\n              }\n            });\n          },\n        });\n      }\n    },\n    onCheckboxGroupChange() {\n      if (this.deleteList.length) {\n        this.setTopBar(true);\n      } else {\n        this.setTopBar()\n      }\n    },\n    loadList() {\n      getMessages({page: this.page, pageSize: this.pageSize}).then(\n        ({ok, data, msg}) => {\n          this.loading = false;\n          if (ok) {\n            if (this.page === 1) {\n              this.list = data.list || [];\n            } else {\n              this.list.push(...(data.list || []));\n            }\n\n            this.finished = this.page * this.pageSize >= data.total;\n            this.page += 1;\n          } else {\n            this.error = true;\n            this.errorText = msg;\n          }\n        }\n      );\n    },\n    handlerClickMsg({status, contentId, content}) {\n      if (status === \"Unread\") {\n        setRead({contentId}).then(({ok, msg}) => {\n          if (ok) {\n            this.$st.set(\"MSG_CONTENT\", content);\n            this.$router.push(\"/msg_detail\");\n          } else {\n            this.$toast.fail(msg);\n          }\n        });\n      } else {\n        this.$st.set(\"MSG_CONTENT\", content);\n        this.$router.push(\"/msg_detail\");\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.page.page-messages {\n  overflow-y: auto;\n\n  .van-checkbox {\n    margin-right: 8px;\n  }\n\n  .disabled {\n    opacity: 0.5;\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[0]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=1e52e8c3&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","errorText","error","finished","on","$event","loadList","model","value","callback","$$v","loading","expression","onCheckboxGroupChange","deleteList","_l","item","index","key","class","disabled","status","_f","createTime","title","handlerClickMsg","slot","contentId","nativeOn","stopPropagation","e","apply","arguments","staticRenderFns","data","list","page","pageSize","created","methods","setTopBar","label","onClick","deleteMessages","msg","previous","current","_this","oneClickRead","getMessages","_this2","content","setRead","_this3","component"],"sourceRoot":""}