"use strict";(self["webpackChunkez_pay"]=self["webpackChunkez_pay"]||[]).push([[8134],{48134:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page page-user-certify"},[a("van-steps",{attrs:{active:e.stepActive}},[a("van-step",[e._v("上传身份证")]),a("van-step",[e._v("身份识别")]),a("van-step",[e._v(" 人工审核 "),2===e.stepActive?a("div",{staticClass:"bottom-status",class:e.isVerifying?"processing":"failed"},[e._v(" ("+e._s(e.isVerifying?"审核中...":"审核失败:"+e.$root.userInfo.realNameRemark)+") ")]):e._e()])],1),a("van-form",[0===e.stepActive||2===e.stepActive?[a("van-field",{attrs:{disabled:2===e.stepActive,autocomplete:"new-password",label:"姓名",placeholder:"请输入你的名字"},model:{value:e.form.realName,callback:function(t){e.$set(e.form,"realName",t)},expression:"form.realName"}}),a("van-field",{attrs:{disabled:2===e.stepActive,autocomplete:"new-password",label:"身份证号",placeholder:"请输入身份证号码"},model:{value:e.form.idCard,callback:function(t){e.$set(e.form,"idCard",t)},expression:"form.idCard"}}),a("div",{staticClass:"gray-8"}),a("van-cell-group",{attrs:{border:!1,title:"请上传身份证"}},[a("div",{staticClass:"upload"},[a("div",{staticClass:"img"},[a("van-image",{attrs:{src:e.$root.getImageUrl(e.form.idCardFrontImg),fit:"contain"},scopedSlots:e._u([{key:"error",fn:function(){return[a("div",{staticClass:"id"})]},proxy:!0}],null,!1,1031679392)}),a("div",{staticClass:"label"},[e._v("身份证正面")])],1),0===e.stepActive?a("van-uploader",{attrs:{"after-read":e.readImage,"preview-image":!1,"max-count":"1",name:"id","result-type":"file"},nativeOn:{click:function(t){return function(t){return e.uploadID(t,{name:"id"})}.apply(null,arguments)}}},[a("div",{staticClass:"camera"})]):e._e()],1),a("div",{staticClass:"upload"},[a("div",{staticClass:"img"},[a("van-image",{attrs:{src:e.$root.getImageUrl(e.form.idCardReverseImg),fit:"contain"},scopedSlots:e._u([{key:"error",fn:function(){return[a("div",{staticClass:"id-back"})]},proxy:!0}],null,!1,3155635750)}),a("div",{staticClass:"label"},[e._v("身份证反面")])],1),0===e.stepActive?a("van-uploader",{attrs:{"after-read":e.readImage,"preview-image":!1,"max-count":"1",name:"idBack","result-type":"file"},nativeOn:{click:function(t){return function(t){return e.uploadID(t,{name:"idBack"})}.apply(null,arguments)}}},[a("div",{staticClass:"camera"})]):e._e()],1)]),e.isVerifying||2!==e.stepActive?a("van-button",{staticClass:"primary block",on:{click:e.onNext}},[e._v(" 下一步")]):a("van-button",{staticClass:"primary block",on:{click:e.onReCertify}},[e._v(" 请重新认证 ")])]:e._e(),1===e.stepActive?[a("div",{staticClass:"step2"},[a("div",{staticStyle:{display:"flex","justify-content":"center","font-size":"13px","align-items":"center"}},[a("van-count-down",{ref:"countdown",staticStyle:{color:"red"},attrs:{time:e.time,format:"mm:ss"},on:{finish:e.finish}}),e._v("  秒后刷新 ")],1),a("div",{staticClass:"numbers"},e._l(e.form.code,(function(t,i){return a("span",{key:i,staticClass:"number"},[e._v(" "+e._s(t)+" ")])})),0),a("div",{staticClass:"tip"},[e._v(" 请录制一段本人视频， "),a("span",{staticStyle:{color:"red"}},[e._v(" 证件放在下颚，念出数字"+e._s((e.form.code||[]).join(""))+"， ")]),e._v(" 视频长度最长10秒，且大小不超过40M ")]),a("van-uploader",{attrs:{"after-read":e.readVideo,"max-size":41943040,"preview-full-image":!1,"preview-image":!1,accept:"video/*"},on:{oversize:function(t){return e.$toast("视频不得超过40M")}}},[a("van-button",{staticClass:"primary block",attrs:{loading:e.showUploadProgress,icon:"plus"}},[e._v(" 点击上传视频 ")])],1),a("van-popup",{staticClass:"progressPopup",attrs:{"close-on-click-overlay":!1},model:{value:e.showUploadProgress,callback:function(t){e.showUploadProgress=t},expression:"showUploadProgress"}},[a("van-circle",{attrs:{rate:0,speed:100,text:"上传进度:"+e.currentRate.toFixed(0)+"%"},model:{value:e.currentRate,callback:function(t){e.currentRate=t},expression:"currentRate"}})],1)],1)]:e._e()],2),a("van-dialog",{staticClass:"uploadAlert",attrs:{"show-confirm-button":!1,"close-on-click-overlay":""},on:{close:e.onDialogClose},scopedSlots:e._u([{key:"title",fn:function(){return[a("van-icon",{attrs:{name:"success"}}),a("div",[e._v("上传成功")])]},proxy:!0}]),model:{value:e.showSuccessTip,callback:function(t){e.showSuccessTip=t},expression:"showSuccessTip"}},[a("div",[e._v("人工审核需要3-10分钟")]),a("div",[e._v(" 审核结果在 "),a("span",[e._v("「用户中心-实名认证」")]),e._v(" 中查看 ")])])],1)},s=[],o=a(49749),r=a(39873),n=a(37174),l=(a(83040),a(83710),a(68309),a(47042),a(74916),a(15306),a(69600),a(21249),a(76591)),c=a.n(l),u=a(42008),d=a(53045),f=a(64436),m=a(58509),p=a(31581);a(77601),a(4723),a(91058),a(41539),a(39714);function v(e){function t(e){var t={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},a="",i=!0;if(e&&/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|[xX])$/i.test(e))if(t[e.substr(0,2)]){if(18==e.length){e=e.split("");for(var s=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],o=[1,0,"X",9,8,7,6,5,4,3,2],r=0,n=0,l=0,c=0;c<17;c++)n=e[c],l=s[c],r+=n*l;o[r%11];o[r%11]!=e[17]&&(a="校验位错误,结尾是字母请注意大小写",i=!1)}}else a="地址编码错误",i=!1;else a="身份证号格式错误",i=!1;return[i,a]}return t(e)[0]}function g(e){function t(e){var t={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},a=/^[1-9]\d{5}(19|20)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i,i="",s=!0;if(e)if(e.match(a))if(t[e.substr(0,2)]){if(18===e.length){e=e.split("");for(var o=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],r=[1,0,"X",9,8,7,6,5,4,3,2],n=0,l=0,c=0,u=0;u<17;u++)l=parseInt(e[u]),c=o[u],n+=l*c;var d=r[n%11];d.toString()!==e[17]&&(i="请输入正确的身份证号码",s=!1)}}else i="请输入正确的身份证号码",s=!1;else i="请输入正确的身份证号码",s=!1;else i="请输入身份证号码",s=!1;return{errorMessage:i,isPass:s}}return t(e).isPass}function h(e){for(var t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],a=["1","0","X","9","8","7","6","5","4","3","2"],i=e+"",s=e[17],o=i.substring(0,17),r=o.split(""),n=r.length,l=0,c=0;c<n;c++)l+=r[c]*t[c];var u=l%11,d=a[u],f=/^[1-9][0-9]{5}([1][9][0-9]{2}|[2][0][0|1][0-9])([0][1-9]|[1][0|1|2])([0][1-9]|[1|2][0-9]|[3][0|1])[0-9]{3}([0-9]|[X])$/,m=f.test(e);return!(s!==d||!m)||v(e)||g(e)}a(20900);var C={data:function(){return{stepActive:0,isVerifying:!1,showSuccessTip:!1,form:{realName:"",idCard:"",idCardFrontImg:"",idCardReverseImg:"",faceImg:"",code:[]},idCardImg:[],idCardBackImg:[],isFaceCollecting:!1,featureCount:0,uploadInfo:{imageUrl:"",token:"",uploadUrl:""},showUploadProgress:!1,currentRate:0,time:0}},created:function(){var e=this;this.$root.isH5Plus&&window.plus.camera.getCamera();var t=m.Z.loading("查询审核状态中...");this.$root.$emit("root:close-identify-dialog"),this.$root.$emit("root:set-topbar",["left-back"]),this.$root.fetchUserInfo().then((function(a){if(t.close(),a){var i=e.$root.userInfo.auditRealNameStatus;""===i&&(e.stepActive=0),0===i&&(e.stepActive=2,e.isVerifying=!0,e.$dialog.alert({className:"common alert",message:"实名认证资料正在人工审核中，请耐心等待",beforeClose:function(t,a){e.$router.back(),a()}})),2===i&&(e.stepActive=2)}else e.$dialog.alert({className:"common",message:"查询审核状态失败，请稍后再试",beforeClose:function(t,a){e.$router.back(),a()}})}))},methods:{readVideo:function(e){var t=(0,p.vc)(new Date,"YMDhms"),a=c()(t+e.file.name)+".".concat(e.file.name.split(".").pop()||"unknown");this.uploadLargeVideo(e,a)},uploadLargeVideo:function(e,t){for(var a=this,i=(e.content||"").split(","),s=(0,n.Z)(i,2),o=(s[0],s[1]),r=[],l=2048e3,c=100/r.length,u=0;u*l<o.length;)u++,r.push(o.slice((u-1)*l,u*l));c=100/r.length;var d=0,m=t,p=function e(){d>=r.length||(0,f.H6)({videoBase64:r[d],blockOrder:d+1,blockNum:r.length,fileName:m},{onUploadProgress:function(e){a.currentRate=c*d+e.loaded/e.total*c}}).then((function(t){var i=t.ok,s=t.data;i?(a.currentRate=(d+1)/r.length*100,s.feof?(a.form.faceImg=s.fileName,a.submit(),a.$toast.success("上传成功"),a.finishUpload()):(m=s.nextFileName,d++,e())):(a.finishUpload(),a.$toast.fail("上传失败"))}))};this.showUploadProgress=!0,p()},finishUpload:function(){this.showUploadProgress=!1,this.currentRate=0},uploadID:function(e,t){var a=this;this.$root.isH5Plus&&(e.preventDefault(),window.h5p.uploadImage(function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(i,s,o,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i?(n=new File([i],s,{type:o}),a.readImage({file:n,_filePath:r},t)):a.$toast.fail("获取图片失败");case 1:case"end":return e.stop()}}),e)})));return function(t,a,i,s){return e.apply(this,arguments)}}()))},readImage:function(e,t){var a=this;e.status="uploading",e.message="上传中...",(0,u.ws)({_file:e.file,imgFile:this.$root.isH5Plus?e._filePath:e.file,type:"authImg"}).then((function(i){var s=i.ok,o=i.data,r=i.msg;s?(e.status="done",e.url=o.name,"id"===t.name&&(a.form.idCardFrontImg=o.name),"idBack"===t.name&&(a.form.idCardReverseImg=o.name)):(e.status="error",e.message="上传失败",a.$toast.fail(r))}))},onNext:function(){return this.form.realName?h(String(this.form.idCard.replace(" ","")))?this.form.idCardFrontImg?this.form.idCardReverseImg?(this.stepActive+=1,void this.countdownCode()):this.$toast.fail("请上传身份证反面照片"):this.$toast.fail("请上传身份证正面照片"):this.$toast.fail("请输入合法身份证号码"):this.$toast.fail("请输入真实用户名")},onReCertify:function(){this.stepActive=0},onDialogClose:function(){this.$router.back()},submit:function(){var e=this;(0,d.ib)((0,o.Z)((0,o.Z)({},this.form),{},{code:this.form.code.join("")})).then((function(t){var a=t.ok,i=t.msg;a?(e.$root.userInfo.auditRealNameStatus=0,e.showSuccessTip=!0):e.$toast.fail(i)}))},countdownCode:function(){this.time=3e5,this.form.code=[0,0,0,0].map((function(){return Math.floor(10*Math.random())}))},finish:function(){this.form.code=[0,0,0,0].map((function(){return Math.floor(10*Math.random())})),this.$refs.countdown.reset()}}},b=C,k=a(1001),w=(0,k.Z)(b,i,s,!1,null,null,null),y=w.exports},64436:function(e,t,a){a.d(t,{H6:function(){return r},Z3:function(){return o},mg:function(){return s}});var i=a(95426),s=function(e){return(0,i.q)({url:"/Api/Common/VerifyCode/getImageCode",method:"POST",data:e})},o=function(e){return(0,i.q)({url:"/Api/Common/VerifyCode/sendCode",method:"POST",data:e})},r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.q)({url:"/Api/User/UploadFile/uploadLargeVideo",method:"POST",data:e,opts:t})}},20900:function(e,t,a){a(41539)}}]);
//# sourceMappingURL=8134.6100d9ec.js.map