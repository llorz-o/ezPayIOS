"use strict";(self["webpackChunkez_pay"]=self["webpackChunkez_pay"]||[]).push([[5315],{15889:function(t,a,s){s.r(a),s.d(a,{default:function(){return I}});var e=function(){var t,a=this,s=a.$createElement,e=a._self._c||s;return e("div",{staticClass:"page page-transaction_buy"},[e("div",{staticClass:"top-wrapper"},[e("div",{staticClass:"card"},[e("div",{staticClass:"title"},[e("span",{staticClass:"split"}),e("span",{staticClass:"status",class:a._f("transactingOrderStatus")(a.status)},[a._v(" "+a._s(a._f("transactingOrderStatus")(a.status,"buyer-content"))+" ")]),e("span",{staticClass:"btn",class:{loading:a.loading},on:{click:function(){return a.loadOrderDetail(a.orderInfo.orderId)}}},[e("van-icon",{attrs:{name:"replay"}})],1)]),e("div",{staticClass:"time"},[a.status==a.TRANSACTING_ORDER_STATUS.BUYER_REQUEST?[a._v(" 卖家 "),e("span",{staticStyle:{color:"red"}},[a._v(" "+a._s(a.$root.waitingSellerConfirmOrderStr)+" ")]),a._v(" 内未确认订单，系统默认卖家取消交易 ")]:a._e(),a.status==a.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER?[a._v(" 买家 "),e("span",{staticStyle:{color:"red"}},[a._v(" "+a._s(a.$root.buyerPayingTimeOverStr)+" ")]),a._v(" 内未操作,系统将默认买家取消交易 ")]:a._e(),a.status==a.TRANSACTING_ORDER_STATUS.TIME_OVER?[a._v(" 未操作超时取消，如有异议请在30分钟内提交 "),e("span",{staticStyle:{color:"#fb2222"}},[a._v("[申请客服介入]")]),a._v(" ，否则交易将自动结束，买家无法收到转币 ")]:a._e(),a.status==a.TRANSACTING_ORDER_STATUS.TRANSFERRED?[a._v(" 卖家确认付款后系统将自动将币转入您的账户 ")]:a._e(),a.status==a.TRANSACTING_ORDER_STATUS.DISPUTING?[a._v(" 争议订单将由官方客服介入协助处理 ")]:a._e(),a.status!=a.TRANSACTING_ORDER_STATUS.SELLER_DID_NOT_RECEIVE||a.isCountdownEnd?a._e():[a._v(" 卖家已提交 "),e("span",{staticStyle:{color:"#fb2222"}},[a._v("[未收到付款]")]),a._v(" ，如有异议请在30分钟内提交 "),e("span",{staticStyle:{color:"#6f59fe"}},[a._v("[申请客服介入]")]),a._v(" ，否则交易将自动结束买家无法收到转币 ")],a.status==a.TRANSACTING_ORDER_STATUS.SELLER_DID_NOT_RECEIVE&&a.isCountdownEnd?[a._v(" 超时未提交异议，系统自动结束交易 ")]:[a._v("  ")]],2),e("div",{staticClass:"orderId"},[a._v(" 订单编号 "+a._s(a.orderInfo.orderNo)+" "),e("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:a.orderInfo.orderNo||"",expression:"orderInfo.orderNo || ''"}],staticClass:"copy copyBtn",on:{success:a.$root.copySuccessful}})])])]),e("van-cell",{staticClass:"kv amount",attrs:{title:"购买数量"}},[a._v(" V币 "+a._s(parseFloat(a.orderInfo.amount).toFixed(2))+" ")]),e("van-cell",{staticClass:"kv payment",attrs:{title:"收款方式"}},[a.PAYMENT_METHOD.BANK===a.orderInfo.paymentType?e("div",{staticClass:"payment-icon bank"}):a._e(),a.PAYMENT_METHOD.ALI===a.orderInfo.paymentType?e("div",{staticClass:"payment-icon ali"}):a._e(),a.PAYMENT_METHOD.WE_CHAT===a.orderInfo.paymentType?e("div",{staticClass:"payment-icon wechat"}):a._e()]),e("van-cell-group",{attrs:{border:!1,title:"交易进度"},scopedSlots:a._u([{key:"title",fn:function(){return[e("span",{staticClass:"title"},[a._v("交易进度")]),a.status===a.TRANSACTING_ORDER_STATUS.BUYER_REQUEST||a.status===a.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER||a.status===a.TRANSACTING_ORDER_STATUS.TIME_OVER||a.status===a.TRANSACTING_ORDER_STATUS.SELLER_DID_NOT_RECEIVE&&!a.isCountdownEnd?e("span",{staticClass:"countdown"},[a._v(" 订单倒计时 "),e("van-count-down",{attrs:{time:a.countdown},on:{finish:a.onCountdownFinish}})],1):a._e()]},proxy:!0}])},[e("van-steps",{attrs:{active:a.stepsActive}},[e("van-step",[a._v(" "+a._s(a._f("dateFormat")(a.orderInfo.createTime,"M/D"))+" "),a.BUYER_STEP[a.status]>=0?e("div",{staticClass:"bottom-status time"},[a._v(" "+a._s(a._f("dateFormat")(a.orderInfo.createTime,"h:m:s"))+" ")]):a._e()]),e("van-step",[a._v(" 卖家确认交易 "),a.BUYER_STEP[a.status]>=0?e("div",{staticClass:"bottom-status",class:a._f("transactingOrderStatus")(a.status,void 0,1)},[a._v(" "+a._s(a._f("transactingOrderStatus")(a.status,"step",1))+" ")]):a._e()]),e("van-step",[a._v(" 买家转账 "),a.BUYER_STEP[a.status]>=2?e("div",{staticClass:"bottom-status",class:(t={},t["time-over"]=a.isTimeoutDisputing,t[a.transactingOrderStatus(a.status,void 0,2)]=!0,t)},[a.isTimeoutDisputing?[a._v(" 超时取消")]:[a._v(" "+a._s(a._f("transactingOrderStatus")(a.status,"step",2))+" ")]],2):a._e()]),e("van-step",[a._v(" 交易完成 "),a.BUYER_STEP[a.status]>=3?e("div",{staticClass:"bottom-status",class:a._f("transactingOrderStatus")(a.status)},[a._v(" "+a._s(a._f("transactingOrderStatus")(a.status,"step"))+" ")]):a._e()])],1)],1),e(a.componentsMapping[a.orderInfo.paymentType],{tag:"components",attrs:{hide:a.hide,payment:a.hide?void 0:a.sellerPayment,title:"卖方收款信息"}}),e(a.componentsMapping[a.orderInfo.paymentType],{tag:"components",attrs:{hide:a.hide,payment:a.hide?void 0:a.buyerPayment,title:"买方付款信息"}}),a.status==a.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER||a.status==a.TRANSACTING_ORDER_STATUS.TRANSFERRED||a.status==a.TRANSACTING_ORDER_STATUS.SELLER_DID_NOT_RECEIVE&&!a.isCountdownEnd||a.status==a.TRANSACTING_ORDER_STATUS.DISPUTING?[a.BUYER_STEP[a.status]>2?e("van-image",{staticClass:"certificationImage",attrs:{src:a.$root.getImageUrl(a.orderInfo.voucher),fit:"contain"},on:{click:function(t){a.previewImage(a.$root.getImageUrl(a.orderInfo.voucher))}}}):e("div",[a.imageList.length&&a.imageList[0]&&a.imageList[0].url?e("div",{staticClass:"van-uploader fake"},[e("div",{staticClass:"van-uploader__wrapper"},[e("div",{staticClass:"van-uploader__preview",on:{click:a.previewImage}},[e("div",{staticClass:"van-image van-uploader__preview-image"},[e("img",{staticClass:"van-image__img",staticStyle:{"object-fit":"contain"},attrs:{src:a.imageList[0].url}})])]),e("div",{staticClass:"van-uploader__preview-delete",on:{click:function(t){a.imageList=[]}}},[e("i",{staticClass:"\n                van-icon van-icon-cross\n                van-uploader__preview-delete-icon\n              "})])])]):e("van-uploader",{attrs:{"after-read":a.afterRead,"max-count":1,"preview-image":!0,"image-fit":"contain","result-type":"file"},nativeOn:{click:function(t){return function(t){return a.onClickUpload(t)}.apply(null,arguments)}},model:{value:a.imageList,callback:function(t){a.imageList=t},expression:"imageList"}},[e("van-button",{staticClass:"upload"},[e("van-icon",{attrs:{name:"plus"}}),e("div",{staticClass:"text"},[a._v("请上传付款凭证")])],1)],1)],1)]:a._e(),a.status==a.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER?[e("div",{staticClass:"warning"},[a._v(" 1.请务必使用您实名认证的付款方式进行转账，否则卖家有权利 延迟或拒绝转币 ")]),e("div",{staticClass:"warning"},[a._v(" 2.转账成功后请上传真实付款凭证，对于提供虚假付款凭证用户 平台将予以严肃处理，恶意提供虚假转账用户平台封号处理 ")]),e("div",{staticClass:"warning"},[a._v(" 3.上传真实付款凭证后点击「我已转账」等待商家审核 ")])]:a._e(),e("div",{staticClass:"btns"},[a.status==a.TRANSACTING_ORDER_STATUS.TIME_OVER||a.status==a.TRANSACTING_ORDER_STATUS.SELLER_DID_NOT_RECEIVE&&!a.isCountdownEnd?[e("van-button",{staticClass:"primary block",on:{click:a.apply_disputing}},[a._v(" 申请客服介入 ")])]:a._e(),a.status==a.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER?[e("van-button",{staticClass:"danger block",on:{click:a.cancel_transaction}},[a._v(" 取消交易 ")]),e("van-button",{staticClass:"primary block",on:{click:a.is_transferred}},[a._v(" 我已转账 ")])]:a._e(),a.status==a.TRANSACTING_ORDER_STATUS.DISPUTING?[e("van-button",{staticClass:"primary block",on:{click:a.$root.openCustomerService}},[a._v(" 联系客服 ")])]:a._e()],2),e("van-dialog",{staticClass:"applyDialog",attrs:{"confirm-button-color":"#6F59FE","confirm-button-text":"提交申诉","show-cancel-button":"",title:"请简要描述您的申诉内容"},on:{confirm:a.submitApplying},model:{value:a.isApplyDialogVisiblity,callback:function(t){a.isApplyDialogVisiblity=t},expression:"isApplyDialogVisiblity"}},[e("van-field",{attrs:{autocomplete:"new-password",autosize:"",maxlength:"50",placeholder:"0/50",rows:"3","show-word-limit":"",type:"textarea"},model:{value:a.applyContent,callback:function(t){a.applyContent=t},expression:"applyContent"}})],1)],2)},i=[],n=s(39873),o=s(7067),r=(s(83040),s(73210),s(32564),s(68309),s(86947)),l=(s(41539),s(92222),s(60026)),c=function(t,a){return new Promise((function(s,e){l.Z.confirm({title:t,message:a,confirmButtonText:"是",cancelButtonText:"否",confirmButtonColor:"#6f59fe",allowHtml:!0,beforeClose:function(t,a){a(),"confirm"===t&&s()}})["catch"]((function(t){}))}))},u=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return c("你确定取消该笔交易",'<div>\n      <div class="tip">\n        提示：\n      </div>\n      <div>\n        1.如果你已给卖方付款，请勿取消交易；\n      </div>\n      <div>\n      2.如果你在一天内取消<span style="color:#FB2222">'.concat(a,'次</span>买卖订单，当天你的账户将会被停止买卖。\n      </div>\n      <div class="al-c">\n          今日还可取消\n          <span style="color:#FB2222">').concat(t,"次</span>\n          挂单，请谨慎操作\n      </div>\n    </div>\n"))},d=function(){return c("是否已转账",'请再次确认您已使用实名认证账户成功转账，\n如发现有违规操作可能会面临\n<span style="color:#FB2222">\n    「永久封号」\n</span>\n处理')},_=function(){return l.Z.alert({message:'<div class="al-c">请上传付款凭证</div>',confirmButtonColor:"#6f59fe",allowHtml:!0})["catch"]((function(t){}))},p=s(21288),T=s(54025),m=s(42008),v=s(4588),f=s(89828),R={components:{BankPaymentInfo:p.JF,WechatPaymentInfo:p.Ey,AliPaymentInfo:p.q$},mixins:[f.RY],data:function(){var t;return{PAYMENT_METHOD:r.hL,STATUS_TYPE:r.Z2,BUYER_STEP:r.B2,TRANSACTING_ORDER_STATUS:r.eD,status:r.eD.WAITING_FOR_TRANSFER,componentsMapping:(t={},(0,o.Z)(t,r.hL.BANK,"BankPaymentInfo"),(0,o.Z)(t,r.hL.ALI,"AliPaymentInfo"),(0,o.Z)(t,r.hL.WE_CHAT,"WechatPaymentInfo"),t),countdown:0,isTimeOut:!1,loading:!1,isApplyDialogVisiblity:!1,applyContent:"",orderInfo:{},sellerPayment:{},buyerPayment:{},imageList:[]}},computed:{hide:function(){return!(this.status===this.TRANSACTING_ORDER_STATUS.TRANSFERRED&&!this.isCountdownEnd||this.status===this.TRANSACTING_ORDER_STATUS.DISPUTING||this.status===this.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER)},isCountdownEnd:function(){return this.countdown<=0},stepsActive:function(){return this.BUYER_STEP[this.status]},isTimeoutDisputing:function(){return!(this.status!=this.TRANSACTING_ORDER_STATUS.DISPUTING||!this.isTimeOut)}},created:function(){this.load(),this.$root.$emit("root:set-topbar",["left-back","customer-service"])},beforeDestroy:function(){clearTimeout(this.timer)},methods:{transactingOrderStatus:function(){var t;return(t=this.$options.filters).transactingOrderStatus.apply(t,arguments)},cancel_transaction:function(){var t=this;(0,T.y6)(void 0,this.BuyerApiPath).then((function(a){var s=a.ok,e=a.data,i=a.msg;s?u(e.allowedCancelsOrderDailyCount-e.cancelsOrderDailyCount,e.allowedCancelsOrderDailyCount).then((function(){(0,T._d)({orderId:t.$route.params.id},t.BuyerApiPath).then((function(a){var s=a.ok,e=a.msg;s?(t.status=r.eD.BUYRER_CANCELD_DEAL,t.$toast.success(e),t.load()):t.$toast.fail(e)}))})):t.$toast.fail(i)}))},is_transferred:function(){var t=this;return this.imageList.length?this.imageList[0].dataUrl?void d().then((function(){(0,T.l$)({orderId:t.$route.params.id,voucher:t.imageList[0].dataUrl},t.BuyerApiPath).then((function(a){var s=a.ok,e=a.msg;s?(t.status=r.eD.TRANSFERRED,t.$toast.success(e),t.load()):t.$toast.fail(e)}))})):this.$toast.fail("无法获取到要上传的图片"):_()},apply_disputing:function(){this.isApplyDialogVisiblity=!0},submitApplying:function(){var t=this;(0,T.R9)({orderId:this.$route.params.id,remark:this.applyContent.trim()},this.BuyerApiPath).then((function(a){var s=a.ok,e=a.msg;s?(t.applyContent="",t.status===r.eD.TIME_OVER&&(t.isTimeoutDisputing=!0),t.status=r.eD.DISPUTING,t.$toast.success(e),t.load()):t.$toast.fail(e)}))},load:function(){this.loadOrderDetail(this.$route.params.id)},loadOrderDetail:function(t){var a=this;this.loading||(this.loading=!0,(0,T.fW)({orderId:t},this.BuyerApiPath).then((function(t){var s=t.ok,e=t.msg,i=t.data;a.loading=!1,s?(clearTimeout(a.timer),a.orderInfo=i.order,a.sellerPayment=i.sellerPayment,a.buyerPayment=i.buyerPayment,a.orderInfo.appeal>0?(a.status=r.eD.DISPUTING,a.orderInfo.status===r.eD.TIME_OVER&&(a.isTimeOut=!0)):a.status=a.orderInfo.status,i.currentStateExpireTime&&(i.currentStateExpireTime.expire?a.countdown=1e3*i.currentStateExpireTime.expire-a.$root.getServerTime():a.countdown=0),a.refreshStatus()):a.$toast.fail(e)})))},refreshStatus:function(){var t=this;this.timer=setTimeout((function(){(0,T.dF)({orderId:t.orderInfo.orderId},t.BuyerApiPath).then((function(a){var s=a.ok,e=a.data;if(t.refreshStatus(),s){var i=t.status;t.orderInfo.appeal>0?(t.status=r.eD.DISPUTING,e.status===r.eD.TIME_OVER&&(t.isTimeOut=!0)):t.status=e.status,t.status!==i&&t.loadOrderDetail(t.orderInfo.orderId)}}))}),1e4)},onCountdownFinish:function(){this.load()},afterRead:function(t){var a=this;this.$nextTick((function(){if(!a.imageList[0]){if(!t)return Sentry.captureMessage("can not get the file at afterRead function"),void a.$toast.fail("无法获取到要上传的图片");a.imageList[0]=t}a.imageList[0].status="uploading",a.imageList[0].message="上传中...",(0,m.ws)({_file:t.file,imgFile:a.$root.isH5Plus?t._filePath:t.file,type:"tradeImg"}).then((function(t){var s=t.ok,e=t.data,i=t.msg;s?(a.imageList[0].url=a.$root.getImageUrl(e.name),a.imageList[0].dataUrl=e.name,a.imageList[0].status="done",a.$set(a.imageList,0,a.imageList[0])):(a.imageList[0].status="error",a.imageList[0].message="上传失败",a.$set(a.imageList,0,a.imageList[0]),a.$toast.fail(i))}))}))},onClickUpload:function(t){var a=this;this.$root.isH5Plus&&(t.preventDefault(),window.h5p.uploadImage(function(){var t=(0,n.Z)(regeneratorRuntime.mark((function t(s,e,i,n){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:s?(o=new File([s],e,{type:i}),a.imageList=[{file:o,_filePath:n}],a.afterRead(a.imageList[0])):a.$toast.fail("获取图片失败");case 1:case"end":return t.stop()}}),t)})));return function(a,s,e,i){return t.apply(this,arguments)}}()))},previewImage:function(t){t?(0,v.Z)([t]):this.imageList[0]?(0,v.Z)([this.imageList[0].url]):Sentry.captureMessage("transaction_buy previewImage no valid url")}}},S=R,E=s(1001),A=(0,E.Z)(S,e,i,!1,null,null,null),I=A.exports}}]);
//# sourceMappingURL=5315.cd6f387a.js.map